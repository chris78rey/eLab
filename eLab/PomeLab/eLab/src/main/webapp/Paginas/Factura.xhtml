<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <p:growl id="growl" life="3000" />

        <div class="Container100">
            <div class="ContainerIndent">
                <div class="Card ShadowEffect  ">
                    <div class="Container100 Responsive100">
                        <div class="ContainerIndent">
                            <p:panel header="Buscar/Crear">
                                <h:panelGrid columns="1" cellpadding="1">
                                    <h:form id="f1">




                                        <div class="Container100 Responsive100">
                                            <div class="ContainerIndent">                    
                                                <h:panelGrid columns="1" cellpadding="5">
                                                    <p:outputLabel value="Número de Factura:"  />
                                                    <p:autoComplete  value="#{factura.facturaObj.numeroFactura}" completeMethod="#{factura.completeText}"   >
                                                    </p:autoComplete>
                                                </h:panelGrid>                    
                                            </div>
                                        </div>
                                        <div class="Container50 Responsive50">
                                            <div class="ContainerIndent">                    
                                                <h:panelGrid columns="2" cellpadding="5">

                                                    <p:commandButton value="Buscar" 
                                                                     process="@form,:f33" 
                                                                     update=":f2,:f4,:f2:numeroFactura,@form,:f33:btnagre"  
                                                                     actionListener="#{factura.buttonAction}"  />
                                                    <p:commandButton value="Nuevo" 
                                                                     process="@form" 
                                                                     update=":f1,:f2,:f4,:f33"  
                                                                     actionListener="#{factura.buttonAction2}"  />

                                                </h:panelGrid>                    
                                            </div>
                                        </div>






                                    </h:form>

                                </h:panelGrid>
                            </p:panel>
                        </div>
                    </div>

                </div>
            </div>
        </div>


        <h:form id="f2">
            <div class="Container100">
                <div class="ContainerIndent">
                    <div class="Card ShadowEffect  ">
                        <p:panel header="Datos de la factura y cliente">
                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                 
                                    <h:panelGrid columns="1" cellpadding="1">
                                        <p:outputLabel value="NumeroFactura:"  />
                                        <p:inputText id="numeroFactura" style="width: 300px"  value="#{factura.facturaObj.numeroFactura}" title="NumeroFactura" />

                                    </h:panelGrid>                    
                                </div>
                            </div>
                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                    
                                    <h:panelGrid columns="1" cellpadding="1">
                                        <p:outputLabel value="Fecha:"  />
                                        <p:calendar id="fechaCreacion" pattern="MM/dd/yyyy" 
                                                    value="#{factura.facturaObj.fecha}" 
                                                    title="Fecha:"  
                                                    showOn="button"/>

                                    </h:panelGrid>                    
                                </div>
                            </div>


                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                 
                                    <h:panelGrid columns="1" cellpadding="1">
                                        <p:outputLabel value="CcRucPasaporte:" />
                                        <h:panelGrid columns="2" cellpadding="1">
                                            <p:autoComplete id="acSimple" style="width: 300px"  value="#{factura.persona.ccRucPasaporte}"   completeMethod="#{factura.completeText1}" >
                                            </p:autoComplete>
                                            <p:commandButton 
                                                value="..."
                                                process="@form"

                                                update="@form" 
                                                actionListener="#{factura.buttonActionRefreCC}" 
                                                />
                                        </h:panelGrid>

                                    </h:panelGrid>                    
                                </div>
                            </div>
                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                    
                                    <h:panelGrid columns="1" cellpadding="1">
                                        <p:outputLabel value="Apellidos:" for="apellidos" />
                                        <p:inputText id="apellidos" style="width: 300px" value="#{factura.persona.apellidos}" title="Apellidos" />

                                    </h:panelGrid>                    
                                </div>
                            </div>


                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                 
                                    <h:panelGrid columns="1" cellpadding="1">
                                        <p:outputLabel value="Nombres:" for="nombres" />
                                        <p:inputText id="nombres" style="width: 300px" value="#{factura.persona.nombres}" title="Nombres" />
                                    </h:panelGrid>                    
                                </div>
                            </div>
                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                    
                                    <h:panelGrid columns="1" cellpadding="1">
                                        <p:outputLabel value="Telef:" for="telef" />
                                        <p:inputText id="telef" style="width: 300px" value="#{factura.persona.telef}" title="Telef" />

                                    </h:panelGrid>                    
                                </div>
                            </div>





                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                    
                                    <h:panelGrid columns="1" cellpadding="1">
                                        <p:outputLabel value="Celular:" for="celular" />
                                        <p:inputText id="celular" style="width: 300px" value="#{factura.persona.celular}" title="Celular" />


                                    </h:panelGrid>                    
                                </div>
                            </div>
                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                    
                                    <h:panelGrid columns="1" cellpadding="1">
                                        <p:outputLabel value="Email:" for="email" />
                                        <p:inputText id="email" style="width: 300px" value="#{factura.persona.email}" title="Email" />

                                    </h:panelGrid>                    
                                </div>
                            </div>





                            <div class="Container50 Responsive50">
                                <div class="ContainerIndent">                    
                                    <h:panelGrid columns="1" cellpadding="1">

                                        <p:outputLabel value="Direccion:" for="direccion" />
                                        <p:inputText id="direccion" style="width: 300px" value="#{factura.persona.direccion}" title="Direccion" />

                                    </h:panelGrid>                    
                                </div>
                            </div>





                        </p:panel>

                    </div>
                    <p:commandButton 
                        value="Grabar factura" 
                        disabled="#{(factura.facturaObj.cerrada eq 1)}"
                        process="@form"
                        update="@form,:f33" 
                        actionListener="#{factura.buttonAction3}" 
                        />
                </div>
            </div>
        </h:form>













        <div class="Container100">
            <div class="ContainerIndent">
                <div class="Card ShadowEffect  ">
                    <div class="Container100 Responsive100">
                        <div class="ContainerIndent">
                            <h:form id="f33">
                                <h2 class="BigTopic">Detalle del examen</h2>
                                <h:panelGrid rendered="#{ not (factura.facturaObj.id eq null)}" columns="2" cellpadding="1">
                                    <p:outputLabel value="Descuento:"  />
                                    <h:panelGrid columns="2"   cellpadding="1">                                    
                                        <p:selectOneRadio id="descso" layout="pageDirection" value="#{factura.aplicaDescuento}">
                                            <f:selectItem itemLabel="No" itemValue="No"  />
                                            <f:selectItem itemLabel="Sí" itemValue="Sí" />
                                        </p:selectOneRadio>
                                    </h:panelGrid>

                                    <p:outputLabel value="Recomienda:"  />
                                    <p:selectOneMenu   value="#{factura.medico.id}" >
                                        <f:selectItem itemLabel="Select One..........."  itemValue="-1" />
                                        <f:selectItems  
                                            value="#{factura.personas}" 
                                            var="item" 
                                            itemLabel="#{item.apellidos} #{item.nombres}" 
                                            itemValue="#{item.id}"  />
                                    </p:selectOneMenu>

                                    <p:outputLabel value="Item:"  />
                                    <h:panelGrid columns="2">
                                        <p:autoComplete id="idtes" style="width: 300px"  
                                                        value="#{factura.clasifconvalores.s}" 
                                                        completeMethod="#{factura.completeTextItem}" />
                                        <p:commandButton 
                                            value="..." 
                                            process="@form"
                                            update="preciocalculado,btnagre" 
                                            actionListener="#{factura.buttonActionPrecio}" />
                                    </h:panelGrid>
                                    <p:outputLabel value="Precio:"  />
                                    <h:panelGrid columns="2">
                                        <p:inputText id="preciocalculado" value="#{factura.descuentoInputText}"/>
                                        <p:commandButton 
                                            id="btnagre"
                                            value="Agregar" 

                                            disabled="#{factura.descuentoInputText eq 0 or factura.descuentoInputText eq null or (factura.facturaObj.cerrada eq 1)}"
                                            process="@form"
                                            update=":f4:dfact,:f4,idtes,descso,preciocalculado,growl" 
                                            actionListener="#{factura.buttonActionAgregar}" 

                                            />
                                    </h:panelGrid>
                                </h:panelGrid>


                                <h:panelGrid columns="1" cellpadding="1">



                                </h:panelGrid>
                                <h:panelGrid columns="1" cellpadding="1">

                                </h:panelGrid>
                            </h:form>
                        </div>
                    </div>
                </div>
            </div>
        </div>





        <div class="Container100">
            <div class="ContainerIndent">
                <div class="Card ShadowEffect  ">


                    <div class="Container100 Responsive100">
                        <div class="ContainerIndent">
                            <h:form id="f4">
                                <h2 class="BigTopic">Items</h2>
                                <h:panelGrid rendered="#{ not (factura.facturaObj.id eq null)}" columns="1" cellpadding="1">
                                    <p:commandButton id="deleteButton" icon="ui-icon-trash"  
                                                     value="Quitar de la Lista" 
                                                     actionListener="#{factura.destroy}" 
                                                     update="@form" 
                                                     disabled="#{(empty factura.findDetalleFactura) or (factura.facturaObj.cerrada eq 1)  }"/>
                                </h:panelGrid>
                                <p:dataTable id="dfact" 
                                             style="width: 90%;margin-left:2%;margin-right:2%;"  
                                             value="#{factura.findDetalleFactura}" 
                                             var="item"                                
                                             selectionMode="single" 
                                             selection="#{factura.selected}"
                                             paginator="true"
                                             rowKey="#{item.id}"
                                             reflow="true"
                                             rendered="#{ not (factura.facturaObj.id eq null)}"
                                             >

                                    <p:column width="600">
                                        <f:facet name="header">
                                            <h:outputText value="ClasifDescri"/>
                                        </f:facet>
                                        <h:outputText value="#{item.clasifDescri}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Valor"/>
                                        </f:facet>
                                        <h:outputText value="#{item.valor}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Valor del IVA"/>
                                        </f:facet>
                                        <h:outputText value="#{item.ivaValor}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Valor con IVA"/>
                                        </f:facet>
                                        <h:outputText value="#{item.valorConIva}"/>
                                    </p:column>
                                    <f:facet name="footer">

                                    </f:facet>
                                </p:dataTable>


                                <p:dataTable id="dtIVA" value="#{factura.liataIVAByNumeroFactura}" var="item"
                                             style="width: 90%;margin-left:2%;margin-right:2%;"  
                                             paginator="false"
                                             reflow="true"
                                             rendered="#{ not (factura.facturaObj.id eq null)}"
                                             >
                                    <p:column width="600">
                                        <f:facet name="header">
                                            <h:outputText value=""/>
                                        </f:facet>

                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Valor"/>
                                        </f:facet>
                                        <h:outputText value="#{item.valorpu}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Valor del Iva"/>
                                        </f:facet>
                                        <h:outputText value="#{item.ivaValor}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Total"/>
                                        </f:facet>
                                        <h:outputText value="#{item.valorConIva}"/>
                                    </p:column>
                                </p:dataTable>




                                <h:panelGrid rendered="#{ not (factura.facturaObj.id eq null)}" columns="1" cellpadding="1">
                                    <p:commandButton 
                                        value="Finalizar" 
                                        id="finalizar" 
                                        rendered="#{(factura.facturaObj.cerrada eq 0)}"
                                        update=":f1,:f2,:f33,:f4"
                                        actionListener="#{factura.buttonActionFin}" 
                                        >
                                        <p:confirm header="Confirmar" message="Luego de finalizar usted ya no puede modificar la factura" icon="ui-icon-alert" />
                                    </p:commandButton>

                                    <p:confirmDialog global="true" showEffect="fade" hideEffect="explode">
                                        <p:commandButton value="Sí" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                                    </p:confirmDialog>
                                </h:panelGrid>
                            </h:form>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </ui:define>

</ui:composition>